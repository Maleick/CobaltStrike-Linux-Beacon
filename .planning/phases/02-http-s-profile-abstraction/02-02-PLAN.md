---
phase: 02-http-s-profile-abstraction
plan: "02"
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - implant/headers/profile.h
  - implant/src/profile.c
  - implant/src/http.c
  - implant/src/beacon.c
  - implant/src/main.c
  - implant/Makefile
  - implant/headers/config.h
autonomous: true
requirements: ["C2P-01", "C2P-02"]
user_setup: []
must_haves:
  truths:
    - "Runtime HTTP/S metadata and transport fields consume generated profile values instead of direct hard-coded macros."
    - "Default profile runtime semantics remain compatible with existing baseline check-in/task exchange behavior."
  artifacts:
    - path: "implant/headers/profile.h"
      provides: "Profile configuration interface consumed by runtime modules"
      min_lines: 40
    - path: "implant/src/profile.c"
      provides: "Profile accessor/loading logic for generated profile values"
      min_lines: 80
    - path: "implant/src/http.c"
      provides: "HTTP request construction using profile abstraction"
      contains: "profile"
  key_links:
    - from: "implant/src/http.c"
      to: "implant/src/profile.c"
      via: "profile-backed URL and header construction"
      pattern: "profile_get|profile_load|profile_"
    - from: "implant/src/beacon.c"
      to: "implant/headers/profile.h"
      via: "metadata generation uses profile values"
      pattern: "profile_"
---

<objective>
Refactor runtime HTTP/S path to consume profile abstraction with baseline compatibility guarantees.

Purpose: Replace direct macro dependence with profile-backed runtime access while preserving Phase 1 semantic behavior and preventing tracked-source profile edits.
Output: Runtime profile interface/module and HTTP/S metadata transport integration based on generated profile artifacts.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/02-http-s-profile-abstraction/02-CONTEXT.md
@.planning/phases/02-http-s-profile-abstraction/02-RESEARCH.md
@.planning/phases/02-http-s-profile-abstraction/02-01-PLAN.md
@implant/src/http.c
@implant/src/beacon.c
@implant/headers/config.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Introduce runtime profile interface and generated artifact consumption</name>
  <files>implant/headers/profile.h, implant/src/profile.c, implant/Makefile</files>
  <action>Add profile interface and implementation that expose normalized HTTP/S values from generated profile artifact(s). Update build wiring so generated profile artifact is available to implant compile path without mutating tracked source at generation time.</action>
  <verify>make -f implant/Makefile -n OUTPUT=BeaconProfileTest</verify>
  <done>Runtime profile module is compilable and build path references generated profile artifact integration.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor HTTP transport and metadata usage to profile-backed values</name>
  <files>implant/src/http.c, implant/src/beacon.c, implant/src/main.c</files>
  <action>Refactor HTTP URL/header construction and relevant metadata value usage to read from profile abstraction instead of direct compile-time macros. Preserve existing default baseline semantics and command/task exchange behavior.</action>
  <verify>python3 implant/tests/run_regression.py --suite protocol --mode quick && python3 implant/tests/run_regression.py --suite smoke --mode quick</verify>
  <done>Runtime HTTP/S path consumes profile abstraction and baseline protocol/smoke checks remain green.</done>
</task>

<task type="auto">
  <name>Task 3: Preserve compatibility defaults and remove tracked-source profile edit dependency</name>
  <files>implant/headers/config.h, generate-payload/InsertListenerInfo.py</files>
  <action>Retain safe defaults for backward compatibility while removing generation-time reliance on direct profile macro rewrites in tracked source/header files. Ensure resulting flow still supports default and selected profile behavior deterministically.</action>
  <verify>rg -n "C2_SERVER|HTTP_GET_URI|HTTP_POST_URI|USER_AGENT" implant/src/http.c implant/src/beacon.c implant/src/profile.c && python3 generate-payload/validate_profile.py profiles/http/default-profile.json</verify>
  <done>Profile behavior is configurable through artifacts; tracked source/header manual edits are no longer required for profile customization.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `make -f implant/Makefile -n OUTPUT=BeaconProfileTest` succeeds
- [ ] `python3 implant/tests/run_regression.py --suite protocol --mode quick` passes
- [ ] `python3 implant/tests/run_regression.py --suite smoke --mode quick` passes
- [ ] Runtime HTTP path references profile abstraction rather than direct hard-coded profile macros for customization
</verification>

<success_criteria>

- All tasks completed
- Runtime HTTP/S behavior is profile-driven via generated artifacts
- Default profile remains semantically compatible with baseline behavior
- C2P-01 and C2P-02 are addressed without introducing new transport scope

</success_criteria>

<output>
After completion, create `.planning/phases/02-http-s-profile-abstraction/02-02-SUMMARY.md`
</output>
