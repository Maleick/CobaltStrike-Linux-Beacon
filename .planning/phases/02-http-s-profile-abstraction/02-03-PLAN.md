---
phase: 02-http-s-profile-abstraction
plan: "03"
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - implant/tests/fixtures/profiles/http/default-profile.json
  - implant/tests/fixtures/profiles/http/nondefault-profile.json
  - implant/tests/fixtures/protocol/v1/profile/default-metadata.json
  - implant/tests/fixtures/protocol/v1/profile/nondefault-metadata.json
  - implant/tests/test_profile_matrix.py
  - implant/tests/run_regression.py
  - implant/tests/fixture_index.json
  - implant/tests/README.md
autonomous: true
requirements: ["C2P-02", "C2P-03"]
user_setup: []
must_haves:
  truths:
    - "Default and non-default profile variants are regression-tested for semantic compatibility in metadata/task exchange paths."
    - "Profile selection flow is validated through deterministic matrix checks tied to fixture IDs."
  artifacts:
    - path: "implant/tests/test_profile_matrix.py"
      provides: "Automated profile compatibility matrix regression suite"
      min_lines: 100
    - path: "implant/tests/fixtures/profiles/http/default-profile.json"
      provides: "Default profile test fixture representing baseline behavior"
      contains: "profile_id"
    - path: "implant/tests/fixture_index.json"
      provides: "Profile suite fixture registration with requirement traceability"
      contains: "C2P-02"
  key_links:
    - from: "implant/tests/test_profile_matrix.py"
      to: "implant/tests/fixtures/profiles/http/"
      via: "profile matrix fixture loading"
      pattern: "fixtures/profiles/http"
    - from: "implant/tests/run_regression.py"
      to: "implant/tests/test_profile_matrix.py"
      via: "suite dispatch for profile matrix"
      pattern: "profile"
---

<objective>
Validate default/non-default HTTP/S profile compatibility via deterministic regression matrix.

Purpose: Guarantee profile customization remains Cobalt Strike-compatible while preserving baseline behavior and generation-time profile selection guarantees.
Output: Profile fixture matrix, automated profile regression suite, and runner/index integration for Phase 2 compatibility checks.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/STATE.md
@.planning/phases/02-http-s-profile-abstraction/02-CONTEXT.md
@.planning/phases/02-http-s-profile-abstraction/02-RESEARCH.md
@.planning/phases/02-http-s-profile-abstraction/02-01-PLAN.md
@.planning/phases/02-http-s-profile-abstraction/02-02-PLAN.md
@implant/tests/fixture_index.json
@implant/tests/run_regression.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create profile compatibility fixture matrix</name>
  <files>implant/tests/fixtures/profiles/http/default-profile.json, implant/tests/fixtures/profiles/http/nondefault-profile.json, implant/tests/fixtures/protocol/v1/profile/default-metadata.json, implant/tests/fixtures/protocol/v1/profile/nondefault-metadata.json</files>
  <action>Add deterministic fixtures for baseline default and at least one non-default profile variant, including expected metadata/task semantic invariants for each profile context.</action>
  <verify>python3 -m json.tool implant/tests/fixtures/profiles/http/default-profile.json >/dev/null && python3 -m json.tool implant/tests/fixtures/protocol/v1/profile/nondefault-metadata.json >/dev/null</verify>
  <done>Fixture matrix exists and is machine-valid for default and variant profile paths.</done>
</task>

<task type="auto">
  <name>Task 2: Implement automated profile matrix regression suite</name>
  <files>implant/tests/test_profile_matrix.py</files>
  <action>Implement profile-focused regression tests that assert semantic compatibility for metadata/task exchange across default and non-default profiles. Ensure failure diagnostics remain fixture-addressable and deterministic.</action>
  <verify>python3 implant/tests/run_regression.py --suite profile --mode quick</verify>
  <done>Profile suite catches compatibility regressions for both default and non-default profile fixtures.</done>
</task>

<task type="auto">
  <name>Task 3: Integrate profile suite into runner and fixture registry</name>
  <files>implant/tests/run_regression.py, implant/tests/fixture_index.json, implant/tests/README.md</files>
  <action>Wire profile suite into deterministic runner dispatch and fixture index traceability, including C2P requirement mapping and quick/full mode behavior documentation.</action>
  <verify>python3 implant/tests/run_regression.py --suite profile --mode full && bash implant/tests/run_regression.sh --mode full</verify>
  <done>Profile matrix suite is part of standard regression flow with requirement-traceable fixture registration.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Profile fixtures validate with `python3 -m json.tool`
- [ ] `python3 implant/tests/run_regression.py --suite profile --mode quick` passes
- [ ] `python3 implant/tests/run_regression.py --suite profile --mode full` passes
- [ ] Runner/index include profile suite with C2P requirement traceability
</verification>

<success_criteria>

- All tasks completed
- Default + non-default profile compatibility is covered by deterministic tests
- Profile selection/customization contract is regression-protected
- C2P-02 and C2P-03 are enforced through fixture-backed validation

</success_criteria>

<output>
After completion, create `.planning/phases/02-http-s-profile-abstraction/02-03-SUMMARY.md`
</output>
