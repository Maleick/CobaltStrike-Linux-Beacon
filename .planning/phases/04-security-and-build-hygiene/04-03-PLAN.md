---
phase: 04-security-and-build-hygiene
plan: 03
type: execute
wave: 3
depends_on: [04-02]
files_modified: [implant/Makefile, implant-macos/Makefile, .gitignore]
autonomous: true
requirements: [SEC-03]
---

<objective>
Implement automated artifact cleanup and strengthen project hygiene.

Purpose: Prevent leakage of temporary configuration and key material by ensuring it is cleaned up after use.
Output: Hardened Makefiles and refined gitignore.
</objective>

<execution_context>
@/Users/maleick/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Makefile Hardening</name>
  <files>implant/Makefile, implant-macos/Makefile</files>
  <action>
    - Update `make clean` in both Makefiles to explicitly remove all files in the `generated/` directory.
    - Ensure `generated/` directory is recreated if it doesn't exist during the build.
  </action>
  <verify>
    make -C implant clean
    ls implant/generated/
  </verify>
  <done>Makefiles handle generated artifact cleanup correctly.</done>
</task>

<task type="auto">
  <name>Task 2: gitignore refinement</name>
  <files>.gitignore</files>
  <action>
    - Ensure `generated/` directories are globally ignored.
    - Ensure `publickey.txt` and `selected_profile.json` are globally ignored.
  </action>
  <verify>
    git status
  </verify>
  <done>Git ignores all sensitive and build-time artifacts.</done>
</task>

<task type="auto">
  <name>Task 3: Final Phase Verification</name>
  <files></files>
  <action>
    - Perform a full generation and build run for both platforms.
    - Confirm success criteria for Phase 4 are met.
    - Update ROADMAP.md and STATE.md.
  </action>
  <verify>
    Manual end-to-end generation check.
  </verify>
  <done>Phase 4 is verified and complete.</done>
</task>

</tasks>

<verification>
No sensitive artifacts remain in the repository after make clean.
</verification>

<success_criteria>
1. make clean removes all generated config/key headers.
2. Sensitive artifacts are ignored by git.
3. Roadmap and State documents reflect Phase 4 completion.
</success_criteria>

<output>
After completion, create `.planning/phases/04-security-and-build-hygiene/04-03-SUMMARY.md`
</output>
