---
phase: 03-reverse-tcp-transport
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified: [CustomBeacon.cna, generate-payload/InsertListenerInfo.py]
autonomous: true
requirements: [NET-02]
---

<objective>
Update the generation scripts and Aggressor workflow to support transport selection.

Purpose: Allow operators to choose between HTTP/S and TCP transport when generating a beacon.
Output: Integrated transport selection in Aggressor dialog and support for TCP in generation scripts.
</objective>

<execution_context>
@/Users/maleick/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Update InsertListenerInfo.py for transport selection</name>
  <files>generate-payload/InsertListenerInfo.py</files>
  <action>
    - Update `InsertListenerInfo.py` to accept a `transport` argument (http or tcp).
    - Ensure it correctly handles profile loading for both transport types.
    - Output the selected transport to a format that can be consumed by the Makefile during the CNA-driven build.
  </action>
  <verify>
    python3 generate-payload/InsertListenerInfo.py --help
  </verify>
  <done>InsertListenerInfo.py supports transport selection.</done>
</task>

<task type="auto">
  <name>Task 2: Update CustomBeacon.cna for transport detection</name>
  <files>CustomBeacon.cna</files>
  <action>
    - Modify `genPayload` in `CustomBeacon.cna` to detect the transport type from the selected listener.
    - If listener payload is `windows/beacon_http/reverse_http` or `windows/beacon_https/reverse_https`, set transport to `http`.
    - If listener payload is `windows/beacon_bind_tcp` or similar (confirm exact TCP payload type for CS), set transport to `tcp`.
    - Pass the detected `transport` to `InsertListenerInfo.py` and the `make` command.
  </action>
  <verify>
    Visual check of Aggressor logic.
  </verify>
  <done>Aggressor script automatically detects transport and routes build accordingly.</done>
</task>

<task type="auto">
  <name>Task 3: Validate end-to-end generation</name>
  <files></files>
  <action>
    - Simulate a TCP generation run using the refactored scripts.
    - Confirm that the `make` command is invoked with the correct `TRANSPORT=tcp` variable.
    - Verify that the resulting binary is produced in the correct location.
  </action>
  <verify>
    Manual simulation of script calls.
  </verify>
  <done>Generation pipeline is verified for multi-transport support.</done>
</task>

</tasks>

<verification>
Successful simulation of TCP and HTTP generation flows.
</verification>

<success_criteria>
1. InsertListenerInfo.py correctly processes transport-related arguments.
2. Aggressor script detects transport type and passes it to the build system.
3. Makefile is invoked with the appropriate TRANSPORT variable.
</success_criteria>

<output>
After completion, create `.planning/phases/03-reverse-tcp-transport/03-02-SUMMARY.md`
</output>
