---
phase: 03-reverse-tcp-transport
plan: 03
type: execute
wave: 3
depends_on: [03-02]
files_modified: [implant/src/main.c]
autonomous: true
requirements: [NET-03]
---

<objective>
Implement reconnect and backoff logic in the beacon's main loop.

Purpose: Ensure the beacon handles network interruptions gracefully rather than exiting, particularly important for TCP transport.
Output: Hardened main.c with bounded retry/backoff behavior.
</objective>

<execution_context>
@/Users/maleick/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Implement retry loop in main.c</name>
  <files>implant/src/main.c</files>
  <action>
    - Refactor the main loop in `main.c` to handle `beacon_checkin` failures.
    - Implement a simple linear or exponential backoff (e.g., wait 5s, then 10s, up to a max of 60s) between failed check-in attempts.
    - Ensure the beacon does not exit on transport-level errors.
  </action>
  <verify>
    Check logic flow in main.c.
  </verify>
  <done>Main loop is resilient to transient network failures.</done>
</task>

<task type="auto">
  <name>Task 2: Final build and symbol audit</name>
  <files></files>
  <action>
    - Perform a final clean build of both HTTP and TCP beacons.
    - Confirm that no `curl` symbols exist in the TCP binary.
  </action>
  <verify>
    make -C implant clean
    make -C implant TRANSPORT=tcp
    nm bin/beacon | grep curl
  </verify>
  <done>Transport isolation is verified at the symbol level.</done>
</task>

<task type="auto">
  <name>Task 3: Milestone closure documentation</name>
  <files>.planning/ROADMAP.md, .planning/STATE.md</files>
  <action>
    - Update `ROADMAP.md` and `STATE.md` to reflect the completion of Phase 3.
    - Document any transport-specific behavioral notes for operators.
  </action>
  <verify>
    Visual check of documentation.
  </verify>
  <done>Phase 3 is officially closed in the planning docs.</done>
</task>

</tasks>

<verification>
Clean build of all transport variants and verified symbol isolation.
</verification>

<success_criteria>
1. Beacon continues running and retries after a failed check-in.
2. TCP binary does not link against libcurl.
3. Milestone documentation is accurate and complete.
</success_criteria>

<output>
After completion, create `.planning/phases/03-reverse-tcp-transport/03-03-SUMMARY.md`
</output>
