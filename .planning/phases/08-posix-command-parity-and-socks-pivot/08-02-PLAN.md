---
phase: 08-posix-command-parity-and-socks-pivot
plan: 02
type: execute
wave: 2
depends_on: [08-01]
files_modified: [implant-macos/src/pivot.c]
autonomous: true
requirements: [MAC-12]
---

<objective>
Validate the SOCKS pivot implementation on macOS ARM64 and document the FD_SETSIZE limitations.

Purpose: Ensure the SOCKS proxying capability is reliable on macOS and that its architectural constraints are understood.
Output: Verified SOCKS pivot implementation and documented constraints.
</objective>

<execution_context>
@/Users/maleick/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@implant-macos/src/pivot.c
</context>

<tasks>

<task type="auto">
  <name>Task 1: SOCKS Pivot Code Audit</name>
  <files>implant-macos/src/pivot.c</files>
  <action>
    - Audit `implant-macos/src/pivot.c` for any non-POSIX socket options or behaviors.
    - Confirm `select()` usage and its reliance on `FD_SETSIZE`.
    - Check if `CLOCK_MONOTONIC` is available on macOS (it is, since 10.12).
    - Verify that `SO_REUSEADDR` is used correctly for listeners.
  </action>
  <verify>
    make -C implant-macos
  </verify>
  <done>SOCKS pivot code is audited and confirmed compatible with macOS networking stack.</done>
</task>

<task type="auto">
  <name>Task 2: Document FD_SETSIZE and Scaling Constraints</name>
  <files>implant-macos/src/pivot.c</files>
  <action>
    - Add a comment to `implant-macos/src/pivot.c` documenting the `FD_SETSIZE` limit on macOS (default 1024).
    - Document that for v2.0, this limit is acceptable for a single beacon's pivot requirements.
  </action>
  <verify>
    Visual check of comments in pivot.c.
  </verify>
  <done>Networking constraints are documented in the source code.</done>
</task>

<task type="auto">
  <name>Task 3: Final Build and Symbol Verification</name>
  <files></files>
  <action>
    - Perform a final clean build of the macOS beacon.
    - Confirm that no `epoll` or other Linux-specific networking symbols are used.
  </action>
  <verify>
    make -C implant-macos clean
    make -C implant-macos
    grep -r "epoll" implant-macos/src/
  </verify>
  <done>macOS beacon is fully build-verified for Phase 8.</done>
</task>

</tasks>

<verification>
Clean build on macOS ARM64 and source-level documentation of networking limits.
</verification>

<success_criteria>
1. SOCKS pivot compiles without warnings on macOS.
2. Source code documents the FD_SETSIZE constraint.
3. No Linux-specific networking APIs are present.
</success_criteria>

<output>
After completion, create `.planning/phases/08-posix-command-parity-and-socks-pivot/08-02-SUMMARY.md`
</output>
