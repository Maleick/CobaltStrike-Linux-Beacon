---
phase: 01-baseline-validation-harness
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - implant/tests/README.md
  - implant/tests/fixture_index.json
  - implant/tests/fixtures/protocol/v1/metadata/default-http.json
  - implant/tests/fixtures/protocol/v1/tasks/malformed-short-header.bin
  - implant/tests/run_regression.py
  - implant/tests/run_regression.sh
  - implant/Makefile
autonomous: true
requirements: ["REL-01"]
user_setup: []
must_haves:
  truths:
    - "Maintainer can run a quick local regression command and get deterministic pass/fail output."
    - "Protocol fixture metadata is versioned and mapped to REL-01 in a repository index."
  artifacts:
    - path: "implant/tests/fixture_index.json"
      provides: "Versioned fixture registry with requirement traceability"
      contains: "REL-01"
    - path: "implant/tests/run_regression.py"
      provides: "Deterministic regression runner with quick/full modes"
      min_lines: 60
    - path: "implant/tests/run_regression.sh"
      provides: "Single entrypoint used by local and CI workflows"
      min_lines: 20
  key_links:
    - from: "implant/tests/run_regression.sh"
      to: "implant/tests/run_regression.py"
      via: "mode forwarding"
      pattern: "run_regression\.py"
    - from: "implant/tests/run_regression.py"
      to: "implant/tests/fixture_index.json"
      via: "fixture discovery"
      pattern: "fixture_index\.json"
---

<objective>
Establish the Phase 1 regression foundation.

Purpose: Create the canonical fixture contract and deterministic harness entrypoints required by all later Phase 1 validation work.
Output: Versioned fixture index, quick/full regression runner, and Makefile integration hooks.
</objective>

<execution_context>
@/Users/maleick/.codex/get-shit-done/workflows/execute-plan.md
@/Users/maleick/.codex/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-baseline-validation-harness/01-CONTEXT.md
@.planning/phases/01-baseline-validation-harness/01-RESEARCH.md
@implant/Makefile
@implant/src/beacon.c
@implant/src/commands.c
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create versioned protocol fixture corpus and index</name>
  <files>implant/tests/README.md, implant/tests/fixture_index.json, implant/tests/fixtures/protocol/v1/metadata/default-http.json, implant/tests/fixtures/protocol/v1/tasks/malformed-short-header.bin</files>
  <action>Create `implant/tests/` structure with versioned fixture directories under `fixtures/protocol/v1/`. Add a machine-readable `fixture_index.json` that records fixture_id, version, assertion_mode (`semantic`), mapped requirements (`REL-01`), and expected result classification. Ensure fixture index format is deterministic and review-friendly.</action>
  <verify>python3 -m json.tool implant/tests/fixture_index.json >/dev/null</verify>
  <done>Fixture corpus exists in versioned paths and index contains REL-01 traceability entries.</done>
</task>

<task type="auto">
  <name>Task 2: Implement deterministic quick/full regression runner</name>
  <files>implant/tests/run_regression.py, implant/tests/run_regression.sh</files>
  <action>Implement `run_regression.py` to load fixture index, execute semantic assertions, and print compact deterministic summaries (fixture ID + assertion + diff summary on failure). Implement shell wrapper `run_regression.sh` with `--mode quick|full` forwarding. Keep default output concise; add optional verbose toggle without changing default summary behavior.</action>
  <verify>bash implant/tests/run_regression.sh --mode quick --dry-run</verify>
  <done>Runner supports quick/full mode selection and emits deterministic summary-oriented output by default.</done>
</task>

<task type="auto">
  <name>Task 3: Wire harness into build workflow</name>
  <files>implant/Makefile</files>
  <action>Add non-destructive Makefile targets for regression execution (for example `test-quick` and `test-full`) that call the new harness wrapper. Preserve existing build targets and avoid changing release build semantics.</action>
  <verify>make -f implant/Makefile -n test-quick</verify>
  <done>Makefile exposes harness targets suitable for local pre-PR runs and CI invocation.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python3 -m json.tool implant/tests/fixture_index.json` succeeds
- [ ] `bash implant/tests/run_regression.sh --mode quick --dry-run` succeeds
- [ ] `make -f implant/Makefile -n test-quick` shows expected harness invocation
</verification>

<success_criteria>

- All tasks completed
- Canonical fixture/index contract established for REL-01
- Deterministic quick/full harness entrypoints available
- Build workflow includes regression targets without breaking existing build paths
  </success_criteria>

<output>
After completion, create `.planning/phases/01-baseline-validation-harness/01-01-SUMMARY.md`
</output>
